import{d as G,a as Y,c as h,o as ee,e as y,f as T,w as N,Q as U,q as C,n as v,u as l,R as q,S as te,h as w,t as F,r as oe,g as L,F as se,U as R,B as ne,v as J,V as re,X as _,W as ae,Y as x,aB as ie}from"./index-Du4dCbfO.js";import{a as W}from"./axios-BqNK95tu.js";import{b as le,a as O,E as P}from"./index-C1fdLA7_.js";import{b as ue,i as ce,d as j,m as fe,n as H,E as $,_ as de,a3 as pe,a4 as me,f as ye,q as D,a5 as ve}from"./constants-D2akMa4K.js";const Z=["success","info","warning","error"],ge=ue({customClass:{type:String,default:""},dangerouslyUseHTMLString:{type:Boolean,default:!1},duration:{type:Number,default:4500},icon:{type:ce},id:{type:String,default:""},message:{type:j([String,Object]),default:""},offset:{type:Number,default:0},onClick:{type:j(Function),default:()=>{}},onClose:{type:j(Function),required:!0},position:{type:String,values:["top-right","top-left","bottom-right","bottom-left"],default:"top-right"},showClose:{type:Boolean,default:!0},title:{type:String,default:""},type:{type:String,values:[...Z,""],default:""},zIndex:Number}),he={destroy:()=>!0},Ce=["id"],be=["textContent"],Se={key:0},Te=["innerHTML"],Ee=G({name:"ElNotification"}),ke=G({...Ee,props:ge,emits:he,setup(e,{expose:o}){const t=e,{ns:s,zIndex:a}=fe("notification"),{nextZIndex:r,currentZIndex:u}=a,{Close:f}=pe,c=Y(!1);let i;const d=h(()=>{const n=t.type;return n&&H[t.type]?s.m(n):""}),p=h(()=>t.type&&H[t.type]||t.icon),k=h(()=>t.position.endsWith("right")?"right":"left"),K=h(()=>t.position.startsWith("top")?"top":"bottom"),Q=h(()=>{var n;return{[K.value]:`${t.offset}px`,zIndex:(n=t.zIndex)!=null?n:u.value}});function I(){t.duration>0&&({stop:i}=me(()=>{c.value&&b()},t.duration))}function M(){i==null||i()}function b(){c.value=!1}function X({code:n}){n===O.delete||n===O.backspace?M():n===O.esc?c.value&&b():I()}return ee(()=>{I(),r(),c.value=!0}),le(document,"keydown",X),o({visible:c,close:b}),(n,S)=>(y(),T(re,{name:l(s).b("fade"),onBeforeLeave:n.onClose,onAfterLeave:S[1]||(S[1]=z=>n.$emit("destroy")),persisted:""},{default:N(()=>[U(C("div",{id:n.id,class:v([l(s).b(),n.customClass,l(k)]),style:q(l(Q)),role:"alert",onMouseenter:M,onMouseleave:I,onClick:S[0]||(S[0]=(...z)=>n.onClick&&n.onClick(...z))},[l(p)?(y(),T(l($),{key:0,class:v([l(s).e("icon"),l(d)])},{default:N(()=>[(y(),T(te(l(p))))]),_:1},8,["class"])):w("v-if",!0),C("div",{class:v(l(s).e("group"))},[C("h2",{class:v(l(s).e("title")),textContent:F(n.title)},null,10,be),U(C("div",{class:v(l(s).e("content")),style:q(n.title?void 0:{margin:0})},[oe(n.$slots,"default",{},()=>[n.dangerouslyUseHTMLString?(y(),L(se,{key:1},[w(" Caution here, message could've been compromised, never use user's input as message "),C("p",{innerHTML:n.message},null,8,Te)],2112)):(y(),L("p",Se,F(n.message),1))])],6),[[R,n.message]]),n.showClose?(y(),T(l($),{key:0,class:v(l(s).e("closeBtn")),onClick:ne(b,["stop"])},{default:N(()=>[J(l(f))]),_:1},8,["class","onClick"])):w("v-if",!0)],2)],46,Ce),[[R,c.value]])]),_:3},8,["name","onBeforeLeave"]))}});var Ie=de(ke,[["__file","notification.vue"]]);const E={"top-left":[],"top-right":[],"bottom-left":[],"bottom-right":[]},B=16;let Ne=1;const g=function(e={},o=null){if(!ye)return{close:()=>{}};(typeof e=="string"||_(e))&&(e={message:e});const t=e.position||"top-right";let s=e.offset||0;E[t].forEach(({vm:d})=>{var p;s+=(((p=d.el)==null?void 0:p.offsetHeight)||0)+B}),s+=B;const a=`notification_${Ne++}`,r=e.onClose,u={...e,offset:s,id:a,onClose:()=>{we(a,t,r)}};let f=document.body;D(e.appendTo)?f=e.appendTo:ae(e.appendTo)&&(f=document.querySelector(e.appendTo)),D(f)||(f=document.body);const c=document.createElement("div"),i=J(Ie,u,_(u.message)?{default:()=>u.message}:null);return i.appContext=o??g._context,i.props.onDestroy=()=>{x(null,c)},x(i,c),E[t].push({vm:i}),f.appendChild(c.firstElementChild),{close:()=>{i.component.exposed.visible.value=!1}}};Z.forEach(e=>{g[e]=(o={})=>((typeof o=="string"||_(o))&&(o={message:o}),g({...o,type:e}))});function we(e,o,t){const s=E[o],a=s.findIndex(({vm:i})=>{var d;return((d=i.component)==null?void 0:d.props.id)===e});if(a===-1)return;const{vm:r}=s[a];if(!r)return;t==null||t(r);const u=r.el.offsetHeight,f=o.split("-")[0];s.splice(a,1);const c=s.length;if(!(c<1))for(let i=a;i<c;i++){const{el:d,component:p}=s[i].vm,k=Number.parseInt(d.style[f],10)-u-B;p.props.offset=k}}function Oe(){for(const e of Object.values(E))e.forEach(({vm:o})=>{o.component.exposed.visible.value=!1})}g.closeAll=Oe;g._context=null;const Pe=ve(g,"$notify"),V={401:"认证失败，无法访问系统资源",403:"当前操作没有权限",404:"访问资源不存在",default:"系统未知错误，请反馈给管理员"};function je(e){let o="";for(const a of Object.keys(e)){const r=e[a];var t=encodeURIComponent(a)+"=";if(r!==null&&r!==""&&typeof r<"u")if(typeof r=="object"){for(const u of Object.keys(r))if(r[u]!==null&&r[u]!==""&&typeof r[u]<"u"){let f=a+"["+u+"]";var s=encodeURIComponent(f)+"=";o+=s+encodeURIComponent(r[u])+"&"}}else o+=t+encodeURIComponent(r)+"&"}return o}let A={show:!1};W.defaults.headers["Content-Type"]="application/json;charset=utf-8";const m=W.create({baseURL:"/newapi",timeout:1e4});m.interceptors.request.use(e=>{const o=localStorage.getItem("userInfo")?JSON.parse(localStorage.getItem("userInfo")).token:"",t=(e.headers||{}).repeatSubmit===!1;if(e.headers.Authorization="Bearer "+o,e.method==="get"&&e.params){let s=e.url+"?"+je(e.params);s=s.slice(0,-1),e.params={},e.url=s}if(!t&&(e.method==="post"||e.method==="put")){const s={url:e.url,data:typeof e.data=="object"?JSON.stringify(e.data):e.data,time:new Date().getTime()},a=Object.keys(JSON.stringify(s)).length,r=5*1024*1024;if(a>=r)return console.warn(`[${e.url}]: 请求数据大小超出允许的5M限制，无法进行防重复提交验证。`),e}return e},e=>{Promise.reject(e)});m.interceptors.response.use(e=>{console.log(e);const o=e.data.status?200:500,t=V[o]||e.data.msg||V.default;return e.request.responseType==="blob"||e.request.responseType==="arraybuffer"?e.data:o===500?(P({message:t,type:"error"}),Promise.reject(new Error(t))):o===601?(P({message:t,type:"warning"}),Promise.reject(new Error(t))):o!==200?(Pe.error({title:t}),sPromise.reject("error")):Promise.resolve(e.data)},e=>{if(e.status==401||e.response.status==401){A.show||(A.show=!0,location.href="#/login");return}let o=e.response.data.msg||"";return o.includes("timeout")&&(o="系统接口请求超时"),P({message:o,type:"error",duration:5*1e3}),Promise.reject(e)});const qe=e=>m({url:"/user/reguser",method:"POST",data:e}),Fe=e=>m({url:"/user/login",method:"POST",data:e}),_e=()=>m({url:"/my/getinfo",method:"get"}),Le=e=>m({url:"/my/edituserinfo",method:"post",data:e}),Re=()=>m({url:"/user/logout",method:"post"}),xe=ie("userInfo",{state:()=>({token:"",info:{}}),actions:{SETTOKEN(e){this.token=e},GETINFO(){return new Promise((e,o)=>{_e().then(t=>{e(t)}).catch(t=>{o(t)})})},SETINFO(e){this.info=e}},persist:{enabled:!0,strategies:[{key:"USER-INFO",storage:process.client?localStorage:null}]}});export{Le as a,Fe as b,Re as l,qe as r,m as s,xe as u};
